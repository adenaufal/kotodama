import{j as e,r as d,R as Z,a as J,E as X}from"./index.js";import{g as ee}from"./models.js";import"./logger.js";const te=({theme:t,settings:i,onToggleTheme:a,onOpenSettings:s,onClose:o})=>e.jsxs("div",{className:"relative overflow-hidden rounded-b-3xl px-8 pb-10 pt-6 shadow-2xl z-20",style:{backgroundColor:"var(--koto-deep-indigo)",boxShadow:"var(--koto-shadow-lg)",color:t==="light"?"var(--koto-text-primary)":"white"},children:[e.jsx("div",{className:`absolute inset-0 ${t==="dark"?"bg-[radial-gradient(circle_at_top_right,_rgba(244,114,182,0.15),_transparent_40%),radial-gradient(circle_at_top_left,_rgba(96,165,250,0.1),_transparent_40%)]":"bg-[radial-gradient(circle_at_top,_rgba(255,255,255,0.4),_transparent_60%)]"}`}),e.jsxs("div",{className:"relative z-10 flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-[0.25em] opacity-70 mb-1",style:{color:t==="light"?"var(--koto-text-secondary)":"rgba(255,255,255,0.7)"},children:"Kotodama"}),e.jsx("h1",{className:"text-2xl font-bold leading-none tracking-tight bg-gradient-to-r from-[var(--koto-text-primary)] to-[var(--koto-text-secondary)] bg-clip-text text-transparent",children:"AI Composer"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 text-[11px] font-medium px-3 py-1.5 rounded-full koto-glass w-fit",children:[i?.defaultProvider&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[var(--koto-accent-blue)]"}),e.jsx("span",{className:"opacity-80",children:"Provider:"}),e.jsx("span",{className:"font-semibold",children:i.defaultProvider})]}),e.jsx("span",{className:"opacity-30",children:"|"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"opacity-80",children:"Model:"}),e.jsx("span",{className:"font-semibold text-[var(--koto-sakura-pink)]",children:i?.defaultModel?ee(i.defaultModel)?.name:"Auto"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{onClick:a,theme:t,label:`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}):e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx(T,{onClick:s,theme:t,label:"Open settings",children:e.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx(T,{onClick:o,theme:t,label:"Close panel",className:"hover:bg-red-500/10 hover:text-red-500",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),T=({onClick:t,theme:i,label:a,children:s,className:o=""})=>e.jsx("button",{onClick:t,className:`
      inline-flex h-8 w-8 items-center justify-center rounded-xl transition-all duration-200
      ${o}
    `,style:{backgroundColor:i==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.1)",color:i==="light"?"var(--koto-text-primary)":"white"},"aria-label":a,title:a,children:s}),R=[{id:"supportive-encourage",label:"Encouraging",icon:"ðŸ’ª",prompt:"Write an encouraging and supportive reply that shows empathy and offers positive reinforcement.",category:"supportive"},{id:"supportive-empathy",label:"Empathetic",icon:"ðŸ¤",prompt:"Write an empathetic reply that acknowledges their feelings and shows understanding.",category:"supportive"},{id:"thoughtful-insight",label:"Add Insight",icon:"ðŸ’¡",prompt:"Share a thoughtful insight or perspective that adds value to their point.",category:"thoughtful"},{id:"thoughtful-analysis",label:"Analytical",icon:"ðŸ”",prompt:"Provide a deeper analysis or breakdown of the topic they mentioned.",category:"thoughtful"},{id:"engaging-question",label:"Ask Question",icon:"â“",prompt:"Ask an engaging follow-up question that deepens the conversation.",category:"engaging"},{id:"engaging-share",label:"Share Experience",icon:"ðŸ“–",prompt:"Share a relevant personal experience or story that relates to their tweet.",category:"engaging"},{id:"professional-network",label:"Network",icon:"ðŸ¤",prompt:"Write a professional networking-focused reply that opens doors for collaboration.",category:"professional"},{id:"professional-expertise",label:"Share Expertise",icon:"ðŸŽ¯",prompt:"Offer professional expertise or industry insights related to their topic.",category:"professional"},{id:"casual-friendly",label:"Friendly Chat",icon:"ðŸ˜Š",prompt:"Write a casual, friendly reply like chatting with a friend.",category:"casual"},{id:"casual-humor",label:"Light Humor",icon:"ðŸ˜„",prompt:"Add light humor or a playful take on their tweet.",category:"casual"},{id:"appreciative-thanks",label:"Say Thanks",icon:"ðŸ™",prompt:"Express genuine gratitude and appreciation for their post.",category:"appreciative"},{id:"appreciative-agree",label:"Show Agreement",icon:"âœ…",prompt:"Show agreement and amplify their message with added context.",category:"appreciative"}],re=({context:t,onTemplateSelect:i})=>t.type!=="reply"||!t.tweetContext?null:e.jsx("div",{className:"px-8 -mt-6 relative z-10 koto-animate-slideIn",children:e.jsxs("div",{className:"rounded-2xl border backdrop-blur-md p-5 shadow-lg",style:{backgroundColor:"var(--koto-bg-card)",borderColor:"var(--koto-border)",boxShadow:"var(--koto-shadow-md)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-[var(--koto-sakura-pink)] animate-pulse"}),e.jsxs("p",{className:"text-[11px] font-bold uppercase tracking-wider",style:{color:"var(--koto-text-secondary)"},children:["Replying to ",e.jsxs("span",{className:"text-[var(--koto-text-primary)]",children:["@",t.tweetContext.username]})]})]}),e.jsx("p",{className:"text-sm leading-relaxed max-h-32 overflow-y-auto pr-2 custom-scrollbar",style:{color:"var(--koto-text-primary)"},children:t.tweetContext.text}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex items-center gap-3",style:{borderColor:"var(--koto-border)"},children:[e.jsx("label",{className:"text-[11px] font-bold uppercase tracking-wider whitespace-nowrap",style:{color:"var(--koto-text-secondary)"},children:"Quick Start:"}),e.jsxs("div",{className:"relative flex-1 group",children:[e.jsxs("select",{onChange:a=>{const s=R.find(o=>o.id===a.target.value);s&&(i(s),a.target.value="")},className:"w-full appearance-none rounded-lg border bg-transparent px-3 py-1.5 pr-8 text-xs font-medium cursor-pointer transition-colors outline-none focus:ring-2 focus:ring-[var(--koto-sakura-pink)]/30",style:{borderColor:"var(--koto-border)",color:"var(--koto-text-primary)"},defaultValue:"",children:[e.jsx("option",{value:"",className:"bg-[var(--koto-bg-dark)]",children:"Pick a vibe..."}),["supportive","thoughtful","engaging","professional","casual","appreciative"].map(a=>e.jsx("optgroup",{label:a.charAt(0).toUpperCase()+a.slice(1),className:"bg-[var(--koto-bg-dark)]",children:R.filter(s=>s.category===a).map(s=>e.jsxs("option",{value:s.id,children:[s.icon," ",s.label]},s.id))},a))]}),e.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-2.5 flex items-center text-[10px]",style:{color:"var(--koto-text-secondary)"},children:"â–¼"})]})]})]})}),oe=({prompt:t,setPrompt:i,lengthPreset:a,setLengthPreset:s,isThread:o,setIsThread:x,threadLength:c,setThreadLength:u,voices:v,selectedVoiceId:p,setSelectedVoiceId:b,isLoading:f,onGenerate:y,onClear:C,contextType:k})=>e.jsxs("div",{className:"flex-1 flex flex-col gap-5 p-6 overflow-y-auto",children:[e.jsxs("div",{className:"relative group z-0",children:[e.jsx("label",{className:"mb-2 block text-[11px] font-bold uppercase tracking-widest",style:{color:"var(--koto-text-secondary)"},children:"Your Instruction"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:t,onChange:l=>i(l.target.value),placeholder:k==="reply"?"How shall we reply? (e.g. 'Politely disagree and offer an alternative suggestion')":"What's on your mind? (e.g. 'A tweet about the future of AI coding assistants')",className:"w-full min-h-[140px] resize-none rounded-2xl p-4 text-[15px] leading-relaxed outline-none transition-all duration-300 border focus:ring-4",style:{backgroundColor:"var(--koto-bg-input)",color:"var(--koto-text-primary)",borderColor:"transparent"}}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
            textarea:focus {
              border-color: var(--koto-sakura-pink);
              box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.15);
            }
            textarea::placeholder {
              color: var(--koto-text-tertiary);
              opacity: 0.7;
            }
          `}}),e.jsx("div",{className:"absolute bottom-3 right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:t&&e.jsx("button",{onClick:C,className:"text-[10px] font-bold uppercase tracking-wide px-2.5 py-1.5 rounded-lg transition-all hover:scale-105 active:scale-95",style:{backgroundColor:"var(--koto-bg-card)",color:"var(--koto-text-tertiary)",border:"1px solid var(--koto-border)"},children:"Clear"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-[11px] font-bold uppercase tracking-widest",style:{color:"var(--koto-text-secondary)"},children:"Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"relative col-span-1",children:v.length===0?e.jsxs("div",{className:"w-full h-full rounded-xl border border-dashed px-4 py-3 text-xs flex items-center justify-center gap-2 cursor-pointer transition-colors hover:bg-[rgba(236,72,153,0.05)]",onClick:()=>chrome.runtime.sendMessage({type:"open-settings"}),style:{borderColor:"var(--koto-sakura-pink)",color:"var(--koto-text-secondary)"},children:[e.jsx("svg",{className:"w-4 h-4",style:{color:"var(--koto-sakura-pink)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Add Voice"})]}):e.jsxs("div",{className:"relative h-full",children:[e.jsxs("select",{value:p,onChange:l=>b(l.target.value),className:"w-full h-full appearance-none rounded-xl border px-4 py-3 text-sm font-semibold shadow-sm outline-none transition-all cursor-pointer focus:border-[var(--koto-sakura-pink)] focus:ring-2 focus:ring-[var(--koto-sakura-pink)]/20",style:{borderColor:"var(--koto-border)",backgroundColor:"var(--koto-bg-card)",color:"var(--koto-text-primary)"},children:[e.jsx("option",{value:"",children:"Select Voice..."}),v.map(l=>e.jsxs("option",{value:l.id,children:[l.emoji," ",l.name]},l.id))]}),e.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-3 flex items-center text-[10px]",style:{color:"var(--koto-text-tertiary)"},children:e.jsx("svg",{width:"10",height:"6",viewBox:"0 0 10 6",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M1 1L5 5L9 1",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})}),e.jsx("div",{className:"flex bg-[var(--koto-bg-card)] rounded-xl border p-1 col-span-1 h-12",style:{borderColor:"var(--koto-border)"},children:["short","medium","long"].map(l=>e.jsx("button",{onClick:()=>s(l),className:`flex-1 rounded-lg text-[10px] font-bold uppercase tracking-wide transition-all duration-200 relative overflow-hidden ${a===l?"text-white shadow-md":"text-[var(--koto-text-secondary)] hover:bg-[var(--koto-bg-input)]"}`,style:a===l?{background:"linear-gradient(135deg, var(--koto-sakura-pink), #ec4899)"}:{},children:l},l))})]}),k==="compose"&&e.jsxs("div",{className:"mt-3 flex items-center justify-between rounded-xl border px-4 py-2.5 transition-all duration-200 hover:border-[var(--koto-sakura-pink)] hover:bg-[var(--koto-bg-card)]/50 cursor-pointer",style:{borderColor:o?"var(--koto-sakura-pink)":"var(--koto-border)",backgroundColor:o?"rgba(236,72,153,0.03)":"var(--koto-bg-card)"},onClick:()=>x(!o),children:[e.jsxs("div",{className:"flex items-center gap-3 select-none",children:[e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center transition-all duration-300 ${o?"bg-[var(--koto-sakura-pink)] border-[var(--koto-sakura-pink)] scale-110":"border-[var(--koto-border)] bg-[var(--koto-bg-input)]"}`,children:e.jsx("svg",{className:`w-3 h-3 text-white transition-opacity duration-200 ${o?"opacity-100":"opacity-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:`text-sm font-semibold transition-colors ${o?"text-[var(--koto-sakura-pink)]":"text-[var(--koto-text-primary)]"}`,children:"Create Thread"})]}),e.jsxs("div",{className:`flex items-center gap-2 transition-all duration-300 ${o?"opacity-100 translate-x-0":"opacity-0 translate-x-4 pointer-events-none"}`,onClick:l=>l.stopPropagation(),children:[e.jsx("input",{type:"number",value:c,onChange:l=>u(Math.max(2,Math.min(10,parseInt(l.target.value)||2))),className:"w-12 rounded-lg border px-2 py-1 text-center text-xs font-bold outline-none focus:border-[var(--koto-sakura-pink)] text-[var(--koto-text-primary)] bg-[var(--koto-bg-input)]",style:{borderColor:"var(--koto-border)"},min:"2",max:"10"}),e.jsx("span",{className:"text-[10px] font-bold uppercase",style:{color:"var(--koto-text-secondary)"},children:"Tweets"})]})]})]}),e.jsxs("div",{className:"mt-auto space-y-3 pt-2",children:[e.jsxs("button",{onClick:y,disabled:f||!t.trim()||!p,className:"relative overflow-hidden w-full group rounded-xl py-4 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed transform active:scale-[0.98] hover:shadow-xl",style:{background:f||!t.trim()||!p?"var(--koto-border)":"linear-gradient(135deg, var(--koto-sakura-pink) 0%, #d946ef 100%)",boxShadow:f||!t.trim()||!p?"none":"0 8px 25px -6px rgba(217, 70, 239, 0.5)"},children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 translate-x-[-100%] skew-x-[-15deg] group-hover:animate-[shine_1s_ease-in-out_infinite]"}),e.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2 text-sm font-bold tracking-wide text-white",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Crafting magic..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Generate Tweet"]})})]}),e.jsx("div",{className:"flex justify-center gap-4 text-[9px] font-semibold tracking-wider opacity-60 hover:opacity-100 transition-opacity",style:{color:"var(--koto-text-tertiary)"},children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded-[4px] bg-[var(--koto-bg-card)] border border-[var(--koto-border)] font-sans",children:"âŒ˜"}),e.jsx("span",{children:"+"}),e.jsx("kbd",{className:"px-1.5 py-0.5 rounded-[4px] bg-[var(--koto-bg-card)] border border-[var(--koto-border)] font-sans",children:"Enter"}),e.jsx("span",{className:"ml-1",children:"to run"})]})})]})]}),ae=({generatedContent:t,onInsert:i,onRegenerate:a,isLoading:s})=>{if(!t||Array.isArray(t)&&t.length===0)return null;const o=Array.isArray(t),x=c=>{navigator.clipboard.writeText(c).then(()=>{})};return e.jsxs("div",{className:"mt-6 koto-animate-fadeIn mb-8 px-8 flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold tracking-wide",style:{color:"var(--koto-text-primary)"},children:[e.jsx("span",{role:"img","aria-label":"sparkles",className:"mr-2",children:"âœ¨"}),"Generated Output"]}),e.jsx("p",{className:"text-[10px] mt-0.5 font-medium",style:{color:"var(--koto-text-secondary)"},children:"Review and refine before inserting"})]}),e.jsxs("button",{onClick:a,disabled:s,className:"text-[10px] font-bold uppercase tracking-wider flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-all hover:bg-[rgba(236,72,153,0.1)] active:scale-95 disabled:opacity-50",style:{color:"var(--koto-sakura-pink)"},children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerate"]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[o?t.map((c,u)=>e.jsx(H,{content:c,index:u+1,total:t.length,onInsert:()=>i(c),onCopy:()=>x(c)},u)):e.jsx(H,{content:t,onCopy:()=>x(t)}),e.jsx("div",{className:"sticky bottom-0 pt-4 bg-gradient-to-t from-[var(--koto-bg-dark)] via-[var(--koto-bg-dark)] to-transparent z-10 pb-2",children:e.jsxs("button",{onClick:()=>i(),className:"w-full rounded-xl py-4 text-xs font-bold uppercase tracking-widest text-white shadow-lg transition-all transform hover:shadow-xl active:scale-[0.99] group flex items-center justify-center gap-2 overflow-hidden relative",style:{background:"linear-gradient(135deg, #10b981, #059669)",boxShadow:"0 8px 20px -6px rgba(16, 185, 129, 0.5)"},children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 translate-y-[100%] group-hover:translate-y-0 transition-transform duration-300"}),e.jsxs("span",{className:"relative flex items-center gap-2",children:["Insert ",o?"All Tweets":"Tweet",e.jsx("svg",{className:"w-4 h-4 transition-transform group-hover:translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})]})})]})]})},H=({content:t,index:i,total:a,onInsert:s,onCopy:o})=>{const[x,c]=d.useState(!1),u=t.length,v=u>280,p=()=>{o&&(o(),c(!0),setTimeout(()=>c(!1),2e3))};return e.jsxs("div",{className:"group relative rounded-xl border p-5 transition-all duration-300 hover:border-[var(--koto-sakura-pink)] hover:shadow-lg hover:shadow-[rgba(236,72,153,0.05)]",style:{backgroundColor:"var(--koto-bg-card)",borderColor:"var(--koto-border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i&&e.jsxs("span",{className:"text-[9px] font-bold uppercase tracking-wider bg-[var(--koto-bg-input)] border border-[var(--koto-border)] px-2 py-0.5 rounded-full text-[var(--koto-text-secondary)]",children:[i," / ",a]}),e.jsx("div",{className:"ml-auto flex items-center gap-3",children:e.jsxs("span",{className:`text-[10px] font-mono font-medium ${v?"text-[var(--koto-error)]":"text-[var(--koto-text-tertiary)]"}`,children:[u," / 280"]})})]}),e.jsx("p",{className:"whitespace-pre-wrap text-[15px] leading-relaxed font-normal",style:{color:"var(--koto-text-primary)"},children:t}),e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-200 translate-y-1 group-hover:translate-y-0",children:[e.jsx("button",{onClick:p,className:"p-1.5 rounded-lg bg-[var(--koto-bg-input)] border border-[var(--koto-border)] text-[var(--koto-text-secondary)] hover:text-[var(--koto-text-primary)] hover:border-[var(--koto-text-secondary)] transition-colors shadow-sm",title:"Copy text",children:x?e.jsx("svg",{className:"w-3.5 h-3.5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),s&&e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg bg-[var(--koto-success)] text-white shadow-md hover:brightness-110 hover:-translate-y-0.5 transition-all",title:"Insert this tweet only",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})})]})]})},_={prompt:2e3,tweetContent:280,username:15};function O(t,i=_.prompt){if(!t||typeof t!="string")return"";let a=t.trim().replace(/\0/g,"").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").normalize("NFKC");return a.length>i&&(a=a.slice(0,i)),a}function se(t){return{text:O(t.text,_.tweetContent),username:ne(t.username)}}function ne(t){return!t||typeof t!="string"?"":t.replace(/^@/,"").replace(/[^a-zA-Z0-9_]/g,"").slice(0,_.username)}function K(t){return!t||typeof t!="string"?"":t.replace(/"/g,'\\"').replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/`/g,"\\`")}const ie=()=>{const[t,i]=d.useState({type:null}),[a,s]=d.useState(""),[o,x]=d.useState(""),[c,u]=d.useState(!1),[v,p]=d.useState(null),[b,f]=d.useState(!1),[y,C]=d.useState(5),[k,l]=d.useState(null),[F,V]=d.useState([]),[w,L]=d.useState(""),[M,$]=d.useState("light"),[z,D]=d.useState("short");d.useEffect(()=>(G(),window.addEventListener("message",P),()=>{window.removeEventListener("message",P)}),[]),d.useEffect(()=>{const r=n=>{(n.metaKey||n.ctrlKey)&&n.key==="Enter"&&(n.preventDefault(),!c&&!o?j():o&&B()),n.key==="Escape"&&(n.preventDefault(),o?x(""):W()),(n.metaKey||n.ctrlKey)&&n.shiftKey&&n.key==="r"&&(n.preventDefault(),o&&!c&&(x(""),j()))};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[c,o,a,w]);const P=r=>{r.data.type==="context"&&(console.log("[Kotodama Panel] Received context:",{type:r.data.context,hasTweetContext:!!r.data.tweetContext,tweetContext:r.data.tweetContext}),i({type:r.data.context,tweetContext:r.data.tweetContext}),r.data.context==="reply"&&r.data.tweetContext&&s(""))},G=async()=>{try{const r=await chrome.runtime.sendMessage({type:"get-settings"});r.success&&(l(r.data),L(r.data.defaultBrandVoiceId||""),r.data.ui?.theme&&$(r.data.ui.theme==="auto"?"dark":r.data.ui.theme));const n=await chrome.runtime.sendMessage({type:"list-brand-voices"});if(n.success){const h=Array.isArray(n.data)?n.data:[];if(V(h),h.length>0){const m=r.success?r.data.defaultBrandVoiceId:void 0;(m?h.some(S=>S.id===m):!1)||L(h[0].id)}}}catch(r){console.error("Failed to load initial data:",r)}},j=async()=>{const r=O(a);if(!r.trim()){p("Please enter a prompt");return}if(!w){p("Please select a brand voice");return}u(!0),p(null),x("");const n=performance.now();try{const m={short:{min:100,max:150,description:"punchy and concise"},medium:{min:150,max:220,description:"balanced length"},long:{min:220,max:280,description:"detailed but within Twitter's limit"}}[z];let N=r;if(t.type==="reply"&&t.tweetContext){const I=se(t.tweetContext),E=K(I.text);N=`You are replying to @${K(I.username)}'s tweet.

Original tweet: "${E}"

User's instructions: ${r}

Write a reply that:
1. Responds directly to the original tweet
2. Maintains the brand voice
3. Is conversational and engaging
4. Is ${m.description} (${m.min}-${m.max} characters)`}else N=`${r}

Keep the tweet ${m.description} (${m.min}-${m.max} characters).`;const S={prompt:N,brandVoiceId:w,isThread:b,threadLength:b?y:void 0},A=await chrome.runtime.sendMessage({type:"generate",payload:S});if(A.success){const E=performance.now()-n;console.timeEnd("[Kotodama Performance] AI generation"),console.log(`[Kotodama] Gen took ${E.toFixed(0)}ms`);let g=A.data.content;typeof g=="string"?g=g.replace(/^["'](.*)["']$/s,"$1").trim():Array.isArray(g)&&(g=g.map(Q=>Q.replace(/^["'](.*)["']$/s,"$1").trim())),x(g)}else p(A.error||"Generation failed")}catch(h){p(h.message||"An error occurred")}finally{u(!1)}},B=r=>{let n;if(typeof r=="string")n=r;else if(typeof o=="string")n=o;else if(Array.isArray(o)&&o.length>0)n=o.join(`

`);else return;const h=window.location.ancestorOrigins?.[0]||"https://twitter.com";window.parent.postMessage({type:"insert-tweet",content:n},h)},W=()=>{const r=window.location.ancestorOrigins?.[0]||"https://twitter.com";window.parent.postMessage({type:"close-panel"},r)},U=()=>{chrome.runtime.sendMessage({type:"open-settings"})},q=async()=>{const r=M==="light"?"dark":"light";if($(r),k){const n={...k,ui:{...k.ui,theme:r}};try{await chrome.runtime.sendMessage({type:"save-settings",payload:n}),l(n)}catch(h){console.error("Failed to save theme preference:",h)}}},Y=r=>{s(r.prompt)};return e.jsxs("div",{className:`w-full h-full overflow-hidden flex flex-col font-sans transition-colors duration-300 ${M==="light"?"light-mode":""}`,style:{backgroundColor:"var(--koto-bg-dark)",backgroundImage:"linear-gradient(to bottom right, rgba(255,255,255,0.03), rgba(255,255,255,0))"},children:[e.jsx(te,{theme:M,settings:k,onToggleTheme:q,onOpenSettings:U,onClose:W}),e.jsxs("div",{className:"flex-1 flex flex-col relative overflow-hidden",children:[e.jsx(re,{context:t,onTemplateSelect:Y}),v&&e.jsxs("div",{className:"mx-6 mt-4 rounded-xl border px-4 py-3 text-sm flex items-center gap-3 koto-animate-fadeIn relative z-10 shadow-sm",style:{borderColor:"rgba(244, 67, 54, 0.2)",backgroundColor:"rgba(244, 67, 54, 0.05)",color:"var(--koto-error)"},children:[e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"font-medium",children:v})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative",children:o?e.jsx(ae,{generatedContent:o,onInsert:B,onRegenerate:j,isLoading:c}):e.jsx(oe,{prompt:a,setPrompt:s,lengthPreset:z,setLengthPreset:D,isThread:b,setIsThread:f,threadLength:y,setThreadLength:C,voices:F,selectedVoiceId:w,setSelectedVoiceId:L,isLoading:c,onGenerate:j,onClear:()=>{s(""),p(null)},contextType:t.type})})]})]})},le=Z.createRoot(document.getElementById("root"));le.render(e.jsx(J.StrictMode,{children:e.jsx(X,{children:e.jsx(ie,{})})}));
