import{r as y,j as e,R as K,a as V,E as $}from"./index.js";import"./logger.js";const U=/^#{1,6}\s+(.+)$/,P=/^(name|description|examples?|example tweets?)\s*:/i;function W(o){return o.replace(/[\u200B-\u200D\uFEFF]/g,"").trim()}function T(o,m){const l=m.trim();if(!l)return;if(o.length===0){o.push(l);return}const i=o.length-1,s=o[i];s.endsWith("\\")?o[i]=`${s.slice(0,-1)} ${l}`.trim():o.push(l)}function _(o){let m;const l=[],i=[];let s=null;const N=o.replace(/\r\n?/g,`
`).split(`
`);for(const f of N){const p=W(f);if(!p&&s!=="description")continue;const v=p.match(U);if(v){const x=v[1].toLowerCase();if(x.startsWith("name")){s="name";continue}if(x.startsWith("description")){s="description";continue}if(x.startsWith("example")){s="examples";continue}s=null;continue}const g=p.match(P);if(g){const x=g[1].toLowerCase(),u=p.replace(P,"").trim();if(x.startsWith("name")&&u){m=u,s=null;continue}if(x.startsWith("description")){u&&l.push(u),s="description";continue}if(x.startsWith("example")){u&&T(i,u),s="examples";continue}}if(s==="name"){p&&(m=p,s=null);continue}if(s==="description"){l.push(f.trimEnd());continue}if(s==="examples"){if(/^[-*+]\s+/.test(p)){T(i,p.replace(/^[-*+]\s+/,""));continue}if(/^\d+\.\s+/.test(p)){T(i,p.replace(/^\d+\.\s+/,""));continue}if(i.length>0){const x=i.length-1;i[x]=`${i[x]} ${p}`.trim();continue}}}if(!m){const f=o.match(/^#\s+(.+)$/m);f&&(m=W(f[1]))}return{name:m,description:l.join(`
`).trim()||void 0,exampleTweets:i.map(f=>f.replace(/\s+/g," ").trim()).filter(Boolean)}}const b=5,O=o=>/^(https?:\/\/)?(www\.)?(twitter|x)\.com\/[A-Za-z0-9_]+\/status\/\d+/i.test(o.trim()),X=o=>{const m=o.match(/status\/(\d+)/i);return m?m[1]:void 0},q=async o=>{const m=X(o);if(!m)return null;try{const l=await fetch(`https://cdn.syndication.twimg.com/widgets/tweet?id=${m}&lang=en`,{headers:{Accept:"application/json"}});if(!l.ok)return null;const i=await l.json();if(i&&typeof i=="object"){const s=i.text||i.full_text;if(typeof s=="string"&&s.trim())return s.replace(/\s+/g," ").trim()}}catch(l){return console.error("Failed to fetch tweet text",l),null}return null},A=[{id:1,title:"Connect OpenAI",description:"Securely store your OpenAI API key so Kotodama can craft drafts that sound like you.",helper:"Keys are encrypted locally using the Web Crypto API before being written to storage. You can revoke or replace them any time from settings."},{id:2,title:"Teach Your Voice",description:"Share a few cues and examples so responses match the tone, pacing, and vocabulary you use on social.",helper:"Aim for 2–5 high-signal examples. Mention go-to phrases, emojis, or hashtags to keep in heavy rotation."}],z=()=>{const[o,m]=y.useState(1),[l,i]=y.useState(""),[s,N]=y.useState(""),[f,p]=y.useState(""),[v,g]=y.useState(()=>Array.from({length:b},()=>"")),[x,u]=y.useState(()=>Array.from({length:b},()=>"idle")),[D,C]=y.useState(()=>Array.from({length:b},()=>"")),[w,I]=y.useState(!1),[E,k]=y.useState(null),j=y.useRef(Array.from({length:b},()=>0)),S=y.useRef(null);y.useEffect(()=>{if(new URL(window.location.href).searchParams.get("skipRedirect")==="1")return;(async()=>{try{const n=await chrome.runtime.sendMessage({type:"get-settings"});if(n.success){const d=n.data.apiKeys.openai;if(typeof d=="string"&&d.trim()){const r=chrome.runtime.getURL("src/settings/index.html");window.location.replace(r)}}}catch(n){console.error("Failed to verify existing configuration",n)}})()},[]);const B=(t,a)=>{k(null),g(d=>{const r=[...d];return r[t]=a,r}),C(d=>{const r=[...d];return r[t]="",r});const n=j.current[t]+1;j.current[t]=n;const c=a.trim();if(!O(c)){u(d=>{const r=[...d];return r[t]="idle",r});return}u(d=>{const r=[...d];return r[t]="loading",r}),q(c).then(d=>{j.current[t]===n&&(d?(g(r=>{const h=[...r];return h[t]=d,h}),u(r=>{const h=[...r];return h[t]="idle",h})):(u(r=>{const h=[...r];return h[t]="error",h}),C(r=>{const h=[...r];return h[t]="We could not extract text from that tweet link.",h})))}).catch(()=>{j.current[t]===n&&(u(d=>{const r=[...d];return r[t]="error",r}),C(d=>{const r=[...d];return r[t]="Failed to fetch the tweet content. Try pasting the text manually.",r}))})},L=async t=>{const a=t.target.files?.[0];if(a)try{k(null);const n=await a.text(),c=_(n);if(!c.name&&!c.description&&c.exampleTweets.length===0)throw new Error("No brand voice content found");if(c.name&&N(c.name),c.description!==void 0&&p(c.description),c.exampleTweets.length>0){const d=Array.from({length:b},(r,h)=>c.exampleTweets[h]??"");g(d)}u(Array.from({length:b},()=>"idle")),C(Array.from({length:b},()=>"")),j.current=Array.from({length:b},()=>0),k({type:"success",message:"Loaded your brand voice from markdown."})}catch(n){console.error("Failed to import brand voice markdown",n),k({type:"error",message:'Could not parse the markdown file. Include "Name", "Description", and "Example Tweets" sections.'})}finally{S.current?S.current.value="":t.target.value=""}},F=async()=>{if(!s.trim()){alert("Please enter a name for your brand voice");return}if(!f.trim()){alert("Please enter a description for your brand voice");return}const t=v.filter(a=>a.trim()!=="");if(t.length===0){alert("Please provide at least one example tweet");return}I(!0);try{const a={apiKeys:{openai:l},analysisDepth:20,ui:{buttonPosition:"top-right",panelWidth:400,theme:"light"},features:{autoAnalyze:!0,rememberHistory:!0,showToneControls:!0}};await chrome.runtime.sendMessage({type:"save-settings",payload:a});const n={id:crypto.randomUUID(),name:s.trim(),description:f.trim(),exampleTweets:t,toneAttributes:{formality:50,humor:50,technicality:50,empathy:50,energy:50,authenticity:50},category:"custom",tags:[],isTemplate:!1,createdAt:new Date,updatedAt:new Date};await chrome.runtime.sendMessage({type:"save-brand-voice",payload:n}),a.defaultBrandVoiceId=n.id,await chrome.runtime.sendMessage({type:"save-settings",payload:a}),alert("Setup complete! Visit Twitter/X and click the sparkle button in any compose box."),window.close()}catch(a){console.error("Setup failed:",a),alert("Setup failed. Please try again.")}finally{I(!1)}},M=A.length,R=A.find(t=>t.id===o);return e.jsx("div",{className:"relative min-h-screen overflow-hidden light-mode",style:{backgroundColor:"var(--koto-bg-light)",color:"var(--koto-text-primary)"},children:e.jsxs("div",{className:"mx-auto flex min-h-screen max-w-5xl flex-col gap-10 px-5 py-14 sm:px-8 lg:flex-row lg:items-start lg:py-20",children:[e.jsx("aside",{className:"relative w-full overflow-hidden rounded-3xl border p-8 shadow-2xl backdrop-blur xl:w-[340px]",style:{borderColor:"var(--koto-border)",backgroundColor:"var(--koto-surface)",boxShadow:"var(--koto-shadow-lg)"},children:e.jsxs("div",{className:"relative space-y-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-[0.35em]",style:{borderColor:"var(--koto-border)",backgroundColor:"rgba(232, 92, 143, 0.1)",color:"var(--koto-sakura-pink)"},children:"Kotodama setup"}),e.jsx("h1",{className:"text-3xl font-semibold leading-tight sm:text-4xl",style:{color:"var(--koto-text-primary)"},children:"Make the assistant sound like you"}),e.jsx("p",{className:"text-sm",style:{color:"var(--koto-text-secondary)"},children:"Spend two quick steps to lock in access and tone. Everything is stored locally and fully encrypted before it hits disk."})]}),e.jsxs("div",{className:"space-y-6 rounded-2xl border p-6",style:{borderColor:"var(--koto-border)",backgroundColor:"rgba(240, 242, 248, 0.5)"},children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.3em]",style:{color:"var(--koto-sakura-pink)"},children:"You'll cover"}),e.jsxs("ul",{className:"space-y-5 text-sm",style:{color:"var(--koto-text-secondary)"},children:[e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-0.5 inline-flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-indigo-500/80 text-[0.75rem] font-semibold text-white",children:"1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--koto-text-primary)"},children:"Connect your key"}),e.jsx("p",{style:{color:"var(--koto-text-secondary)"},children:"We never transmit or log it—everything stays on this browser profile."})]})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-0.5 inline-flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-indigo-500/80 text-[0.75rem] font-semibold text-white",children:"2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--koto-text-primary)"},children:"Tune your voice"}),e.jsx("p",{style:{color:"var(--koto-text-secondary)"},children:"Add signature phrases or references so generated drafts hit your vibe immediately."})]})]})]})]}),e.jsxs("div",{className:"space-y-3 text-xs uppercase tracking-[0.35em]",style:{color:"var(--koto-text-secondary)"},children:[e.jsx("p",{children:"Zero accounts. Zero analytics."}),e.jsx("p",{children:"Revoke, export, and delete any time."})]})]})}),e.jsx("section",{className:"flex-1",children:e.jsxs("div",{className:"h-full rounded-3xl border backdrop-blur",style:{borderColor:"var(--koto-border)",backgroundColor:"var(--koto-surface)",boxShadow:"var(--koto-shadow-lg)"},children:[e.jsx("header",{className:"space-y-6 border-b px-6 py-8 sm:px-8",style:{borderColor:"var(--koto-border)"},children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-semibold uppercase tracking-[0.35em]",style:{color:"var(--koto-sakura-pink)"},children:["Step ",o," of ",M]}),e.jsx("h2",{className:"text-2xl font-semibold sm:text-3xl",style:{color:"var(--koto-text-primary)"},children:R?.title}),e.jsx("p",{className:"max-w-xl text-sm sm:text-base",style:{color:"var(--koto-text-secondary)"},children:R?.description})]}),e.jsx("ol",{className:"flex items-center gap-2 rounded-full border p-2",style:{borderColor:"var(--koto-border)",backgroundColor:"rgba(240, 242, 248, 0.5)"},children:A.map((t,a)=>{const n=o===t.id,c=o>t.id;return e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`flex h-8 w-8 items-center justify-center rounded-full text-xs font-semibold transition ${c?"bg-indigo-500 text-white":n?"text-indigo-600":""}`,style:n&&!c?{backgroundColor:"white",color:"rgb(79, 70, 229)",boxShadow:"0 0 0 3px rgba(129, 140, 248, 0.25)"}:c?{boxShadow:"0 2px 8px rgba(79, 70, 229, 0.3)"}:!n&&!c?{color:"var(--koto-text-secondary)"}:{},children:t.id}),a<M-1&&e.jsx("span",{className:"h-px w-10 rounded-full transition",style:{backgroundColor:c?"rgba(129, 140, 248, 0.8)":"var(--koto-border)"}})]},t.id)})})]})}),e.jsxs("div",{className:"space-y-8 px-6 py-8 sm:px-8",children:[o===1&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:"var(--koto-text-primary)"},children:"OpenAI API key"}),e.jsx("input",{type:"password",value:l,onChange:t=>i(t.target.value),placeholder:"sk-...",className:"w-full rounded-2xl border px-4 py-3 text-base placeholder:text-slate-400 focus:outline-none focus:ring-2",style:{borderColor:"var(--koto-border)",backgroundColor:"var(--koto-bg-dark)",color:"var(--koto-text-primary)"}}),e.jsxs("p",{className:"text-sm",style:{color:"var(--koto-text-secondary)"},children:["Don't have a key?"," ",e.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"font-medium",style:{color:"var(--koto-sakura-pink)"},children:"Generate one here"}),"."]})]}),e.jsxs("div",{className:"rounded-2xl border p-5 text-sm",style:{borderColor:"var(--koto-border)",backgroundColor:"rgba(240, 242, 248, 0.5)",color:"var(--koto-text-secondary)"},children:[e.jsx("p",{className:"font-semibold",style:{color:"var(--koto-text-primary)"},children:"Why we ask"}),e.jsx("p",{className:"mt-1",children:"Keys are encrypted locally using the Web Crypto API before they're stored. You can revoke or replace them any time from settings."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("button",{type:"button",onClick:()=>i(""),className:"flex-1 rounded-2xl border px-4 py-3 text-base font-medium transition sm:flex-none sm:px-6",style:{borderColor:"var(--koto-border)",backgroundColor:"rgba(240, 242, 248, 0.5)",color:"var(--koto-text-primary)"},children:"Clear field"}),e.jsx("button",{type:"button",onClick:()=>m(2),disabled:!l.trim(),className:"flex-1 rounded-2xl bg-indigo-500 px-4 py-3 text-base font-semibold text-white transition hover:bg-indigo-400 disabled:cursor-not-allowed disabled:shadow-none sm:flex-none sm:px-6",style:{backgroundColor:l.trim()?"rgb(99, 102, 241)":"var(--koto-border)",color:l.trim()?"white":"var(--koto-text-secondary)",boxShadow:l.trim()?"0 4px 12px rgba(79, 70, 229, 0.3)":"none"},children:"Continue"})]})]}),o===2&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--koto-text-primary)"},children:["Brand voice name ",e.jsx("span",{style:{color:"var(--koto-error)"},children:"*"})]}),e.jsx("input",{type:"text",value:s,onChange:t=>{N(t.target.value),k(null)},placeholder:"e.g., Confident, Playful, Technical",required:!0,className:"w-full rounded-2xl border px-4 py-3 text-base placeholder:text-slate-400 focus:outline-none focus:ring-2",style:{borderColor:"var(--koto-border)",backgroundColor:"var(--koto-bg-dark)",color:"var(--koto-text-primary)"}})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--koto-text-primary)"},children:["Description ",e.jsx("span",{style:{color:"var(--koto-error)"},children:"*"})]}),e.jsx("textarea",{value:f,onChange:t=>{p(t.target.value),k(null)},placeholder:"Share key phrases, tone notes, or instructions for the AI...",rows:4,required:!0,className:"w-full rounded-2xl border px-4 py-3 text-base placeholder:text-slate-400 focus:outline-none focus:ring-2",style:{borderColor:"var(--koto-border)",backgroundColor:"var(--koto-bg-dark)",color:"var(--koto-text-primary)"}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",style:{color:"var(--koto-text-primary)"},children:"Import from markdown"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>S.current?.click(),className:"inline-flex items-center justify-center rounded-lg border px-4 py-2 text-sm font-semibold transition",style:{borderColor:"var(--koto-sakura-pink)",backgroundColor:"rgba(232, 92, 143, 0.1)",color:"var(--koto-sakura-pink)"},children:"Upload .md file"}),e.jsx("p",{className:"text-xs",style:{color:"var(--koto-text-secondary)"},children:'Use headings like "Name", "Description", and "Example Tweets" to prefill the form automatically.'})]}),e.jsx("input",{ref:S,type:"file",accept:".md,.markdown,text/markdown",onChange:L,className:"hidden"}),E&&e.jsx("p",{className:`text-xs ${E.type==="error"?"text-rose-400":"text-emerald-400"}`,children:E.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("label",{className:"text-sm font-medium",style:{color:"var(--koto-text-primary)"},children:["Example tweets ",e.jsxs("span",{style:{color:"var(--koto-text-secondary)"},children:["(up to ",b,")"]})]}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--koto-sakura-pink)"},children:"Optional but powerful"})]}),e.jsx("div",{className:"space-y-2",children:v.map((t,a)=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{type:"text",value:t,onChange:n=>B(a,n.target.value),placeholder:`Example ${a+1}...`,className:"w-full rounded-xl border px-3 py-2 text-sm transition focus:outline-none focus:ring-2",style:{borderColor:"var(--koto-border)",backgroundColor:"var(--koto-bg-dark)",color:"var(--koto-text-primary)"}}),x[a]==="loading"&&e.jsx("p",{className:"px-1 text-xs",style:{color:"var(--koto-sakura-pink)"},children:"Fetching tweet text…"}),x[a]==="error"&&e.jsx("p",{className:"px-1 text-xs text-rose-400",children:D[a]})]},a))}),e.jsx("p",{className:"text-xs",style:{color:"var(--koto-text-secondary)"},children:"Paste a tweet link to pull in its text automatically."})]}),e.jsxs("div",{className:"rounded-2xl border p-5 text-sm",style:{borderColor:"var(--koto-border)",backgroundColor:"rgba(240, 242, 248, 0.5)",color:"var(--koto-text-secondary)"},children:[e.jsx("p",{className:"font-semibold",style:{color:"var(--koto-text-primary)"},children:"Pro tip"}),e.jsx("p",{className:"mt-1",children:"Mix short and long examples. Mention catchphrases or hashtags so Kotodama highlights them when drafting replies."})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("button",{type:"button",onClick:()=>m(1),className:"flex-1 rounded-2xl border px-4 py-3 text-base font-semibold transition sm:flex-none sm:px-6",style:{borderColor:"var(--koto-border)",backgroundColor:"rgba(240, 242, 248, 0.5)",color:"var(--koto-text-primary)"},children:"Back"}),e.jsx("button",{type:"button",onClick:F,disabled:w,className:"flex-1 rounded-2xl bg-indigo-500 px-4 py-3 text-base font-semibold text-white transition hover:bg-indigo-400 disabled:cursor-not-allowed disabled:shadow-none sm:flex-none sm:px-6",style:{backgroundColor:w?"var(--koto-border)":"rgb(99, 102, 241)",color:w?"var(--koto-text-secondary)":"white",boxShadow:w?"none":"0 4px 12px rgba(79, 70, 229, 0.3)"},children:w?"Setting up…":"Complete setup"})]})]})]})]})})]})})},G=K.createRoot(document.getElementById("root"));G.render(e.jsx(V.StrictMode,{children:e.jsx($,{children:e.jsx(z,{})})}));
